var Pulsatio=function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e){t.exports=class{constructor(t={}){this.options=Object.assign(this.default,t),this.sendHeartbeat=this.sendHeartbeat.bind(this),this.connect=this.connect.bind(this),this.connect()}get default(){return{port:4200,url:"http://localhost:4200",interval:3e4,interval_timeout:1.1,on:{},data:{}}}connect(){if(this.options.url){let t=this.options.url+"/nodes/",e={id:this.options.id,ip:this.options.ip,interval:this.options.interval,hostname:this.options.hostname,...this.options.data};fetch(t,{method:"POST",body:JSON.stringify(e),headers:new Headers({"content-type":"application/json"})}).then(t=>{t.json().then(t=>{t&&t.id?(this.options.id=t.id,this.options.on.connection&&this.options.on.connection(t),this.sendHeartbeat()):setTimeout(this.connect,this.options.interval)}).catch(t=>{setTimeout(this.connect,this.options.interval)})}).catch(t=>{setTimeout(this.connect,this.options.interval)})}else console.log("No url")}sendHeartbeat(){let t=`${this.options.url}/nodes/${this.options.id}`,e={ip:this.options.ip,_message_id:this.last_message_id};fetch(t,{method:"PUT",body:JSON.stringify(e),headers:new Headers({"content-type":"application/json"})}).then(t=>{t.json().then(t=>{t&&t._message_id&&(this.last_message_id=t._message_id),this.options.on.heartbeat&&this.options.on.heartbeat(t)}).catch(t=>{this.options.on.heartbeat&&this.options.on.heartbeat()}),t&&404!==t.status?(this.disconnected=null,delete this.disconnected,this.timeout=setTimeout(this.sendHeartbeat,this.options.interval)):(this.disconnected=!0,this.connect())}).catch(t=>{this.disconnected=!0,this.connect()})}clearNode(t,e){if(t){if(!0===e){let e={};for(let n in t){let i=Object.assign({},t[n]);i.timeout=null,delete i.timeout,e[n]=i}return e}{let{timeout:e,...n}=t;return n}}return!0===e?{}:void 0}}}]);